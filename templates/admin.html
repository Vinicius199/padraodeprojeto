<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">

<title>Painel Admin - Cadastros</title>
</head>
<body {% if is_editing %}class="editing-mode"{% endif %}> 
    
    <div class="header-links">
        <a href="{% url 'home' %}">üåê Meu Site</a> </div>

    <div class="container">
        <h1>üõ†Ô∏è Painel Administrativo - A√ß√µes de Cadastro</h1>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <div class="action-buttons">
            <button id="openFuncionarioModal" class="action-btn btn-funcionario">
                üë§ Cadastrar Funcion√°rio
            </button>
            <button id="openServicoModal" class="action-btn btn-servico">
                ‚öôÔ∏è Cadastrar Servi√ßo
            </button>
            <button id="openViewFuncionarioModal" class="action-btn btn-view-funcionario">
                üëÄ Ver Funcion√°rios
            </button>
            <button id="openViewServicoModal" class="action-btn btn-view-servico">
                üîç Ver Servi√ßos
            </button>
        </div>
    </div>
    
    <div id="funcionarioModal" class="modal 
        {% if is_editing and profissional %}modal-open{% endif %}">
        
        <div class="modal-content">
            <span class="close-btn" data-modal-target="funcionarioModal">&times;</span>
            
            <h2>üë§ {% if is_editing and profissional %}Editar Funcion√°rio: {{ profissional.get_full_name }}{% else %}Cadastro de Funcion√°rio{% endif %}</h2>
            
            <form id="formFuncionario" 
                action="{% if is_editing and profissional %}{% url 'editar_funcionario' profissional.pk %}{% else %}{% url 'api_cadastrar_profissional_com_login' %}{% endif %}" 
                method="POST">
                
                {% csrf_token %}

                {% if is_editing and profissional %}
                    {# Se estiver editando, o Django form ser√° usado #}
                    {{ form.as_p }}
                    <button type="submit" class="btn-submit">Salvar Altera√ß√µes</button>
                {% else %}
                    <div class="form-group"><label for="nome_func">Nome:</label><input type="text" id="nome_func" name="nome" required /></div>
                    <div class="form-group"><label for="sobrenome_func">Sobrenome:</label><input type="text" id="sobrenome_func" name="sobrenome" required /></div>
                    <div class="form-group"><label for="email_func">Email:</label><input type="email" id="email_func" name="email" required /></div>
                    <div class="form-group"><label for="telefone_func">Telefone:</label><input type="text" id="telefone_func" name="telefone" placeholder="(XX) XXXXX-XXXX" required/></div>
                    <div class="form-group"><label for="senha_func">Senha:</label><input type="password" id="senha_func" name="senha" required /></div>

                    <div class="form-group checkbox-group">
                        <label for="is_staff_func">Tornar Administrador:</label>
                        <div class="checkbox-container"> 
                            <input type="checkbox" id="is_staff_func" name="is_staff" />
                            <small>Marque para dar acesso ao painel administrativo.</small>
                        </div>
                    </div>
                    <button type="submit" class="btn-submit">Salvar Funcion√°rio</button>
                {% endif %}

            </form>
        </div>
    </div>

    <div id="servicoModal" class="modal 
        {% if is_editing and servico %}modal-open{% endif %}">

        <div class="modal-content">
            <span class="close-btn" data-modal-target="servicoModal">&times;</span>
            
            <h2>‚öôÔ∏è {% if is_editing and servico %}Editar Servi√ßo: {{ servico.nome }}{% else %}Cadastro de Servi√ßo{% endif %}</h2>
            
            <form id="formServico" 
                action="{% if is_editing and servico %}{% url 'editar_servico' servico.pk %}{% else %}{% url 'api_cadastrar_servico' %}{% endif %}" 
                method="POST">

                {% csrf_token %}

                {% if is_editing and servico %}
                    {{ form.as_p }}                    
                    <div class="form-group">
                        <label for="funcionarios_servico_edit">Designar Funcion√°rio(s):</label>
                        <select id="funcionarios_servico_edit" name="profissionais" multiple>
                            {% for profissional in profissionais_list %}
                                <option value="{{ profissional.id }}"
                                    {% if profissional in servico.profissionais_aptos.all %}
                                        selected
                                    {% endif %}
                                >
                                    {{ profissional.get_full_name }}
                                </option>
                            {% endfor %}
                            
                            <option value="" disabled>Nenhum profissional cadastrado.</option>
                        </select>
                        <small>Dica: Use Ctrl/Cmd para selecionar m√∫ltiplos funcion√°rios.</small>
                    </div>
                    
                    <button type="submit" class="btn-submit">Salvar Altera√ß√µes</button>
                {% else %}
                    {# Bloco de Cadastro Novo (inputs diretos) #}
                    <div class="form-group"><label for="nome_servico">Nome do Servi√ßo:</label><input type="text" id="nome_servico" name="nome" required /></div>
                    <div class="form-group"><label for="descricao_servico">Descri√ß√£o:</label><textarea id="descricao_servico" name="descricao" required></textarea></div>
                    
                    <div class="form-group">
                        <label for="tempo_servico">Tempo Estimado (Dura√ß√£o):</label>
                        <input type="time" id="tempo_servico" name="tempo" value="00:30" step="60" required/>
                        <small>Em formato HH:MM (ex: 00:30 para 30 minutos)</small>
                    </div>

                    <div class="form-group">
                        <label for="funcionarios_servico">Designar Funcion√°rio(s):</label>
                        <select id="funcionarios_servico" name="profissionais" multiple>
                            {% for profissional in profissionais_list %}
                            <option value="{{ profissional.id }}">{{ profissional.user.nome }} {{ profissional.user.sobrenome }}</option>
                            {% empty %}
                            <option value="" disabled>Nenhum profissional cadastrado.</option>
                            {% endfor %}
                        </select>
                        <small>Dica: Use Ctrl/Cmd para selecionar m√∫ltiplos funcion√°rios.</small>
                    </div>
                    <button type="submit" class="btn-submit">Salvar Servi√ßo</button>
                {% endif %}
            </form>
        </div>
    </div>
    
    <div id="viewFuncionarioModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal-target="viewFuncionarioModal">&times;</span>
            <h2>üëÄ Gerenciar Funcion√°rios</h2>
            <table class="list-table">
                <thead>
                    <tr><th>ID</th><th>Nome</th><th>Email</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody>
                    {% for profissional in profissionais_list %}
                    <tr>
                        <td>{{ profissional.id }}</td>
                        <td>{{ profissional.user.nome }} {{ profissional.user.sobrenome }}</td>
                        <td>{{ profissional.user.email }}</td>
                        <td>
                            <a href="{% url 'editar_funcionario' profissional.id %}" class="action-link btn-edit">‚úèÔ∏è Editar</a>
                            <form action="{% url 'excluir_funcionario' profissional.id %}" method="POST" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="action-link btn-delete" onclick="return confirm('Tem certeza que deseja excluir este funcion√°rio?');">‚ùå Excluir</button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Nenhum funcion√°rio cadastrado.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="viewServicoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal-target="viewServicoModal">&times;</span>
            <h2>üîç Gerenciar Servi√ßos</h2>
            <table class="list-table">
                <thead>
                    <tr><th>ID</th><th>Nome do Servi√ßo</th><th>Dura√ß√£o (Minutos)</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody>
                    {% for servico in servicos_list %}
                    <tr>
                        <td>{{ servico.id }}</td>
                        <td>{{ servico.nome }}</td> 
                        <td>{{ servico.duracao_minutos }} min</td> 
                        <td>
                            <a href="{% url 'editar_servico' servico.id %}" class="action-link btn-edit">‚úèÔ∏è Editar</a>
                            <form action="{% url 'excluir_servico' servico.id %}" method="POST" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="action-link btn-delete" onclick="return confirm('Tem certeza que deseja excluir este servi√ßo?');">‚ùå Excluir</button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Nenhum servi√ßo cadastrado.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script src="{% static 'js/admin.js' %}"></script>
</body>
</html>